$(document).ready(function(){$("#firetext").blur(function(){FireworkDisplay.getTinyUrl()});try{$("#firetext").get(0).focus()}catch(d){}var a=null;$(window).bind("resize",function(){if(document.all)return;a&&clearTimeout(a);a=setTimeout("location.reload()",100)});var c=location.search,b="";if(c.match("msg=")){b=unescape(c.split("?msg=")[1]);$("#firetext").val(b)}FireworkDisplay.launchText()});$(document).ready(function(){$("#slider_firework_speed").slider({slide:function(b,a){FireworkDisplay.FIREWORK_SPEED=a.value},value:FireworkDisplay.FIREWORK_SPEED,max:5,step:.1,orientation:"vertical"});$("#slider_fragment_spread").slider({slide:function(b,a){FireworkDisplay.FRAGMENT_SPREAD=a.value},value:FireworkDisplay.FRAGMENT_SPREAD,max:20,orientation:"vertical"});$("#slider_gravity").slider({slide:function(b,a){FireworkDisplay.GRAVITY=a.value},value:FireworkDisplay.GRAVITY,step:.1,min:-10,max:20,orientation:"vertical"})});FireworkDisplay={GRAVITY:5,FRAME_RATE:30,DEPLOYMENT_RATE:10,FIREWORK_SPEED:2,DISPERSION_WIDTH:1,DISPERSION_HEIGHT:2,FIREWORK_PAYLOAD:10,FRAGMENT_SPREAD:8,TEXT_LINE_HEIGHT:70,FIREWORK_READY:0,FIREWORK_LAUNCHED:1,FIREWORK_EXPLODED:2,FIREWORK_FRAGMENT:3,canvas:0,svg:0,svgGroup:0,canvaswidth:0,canvasheight:0,ctx:0,blockPointer:0,fireworks:[],allBlocks:[],gameloop:0,updateDisplay:function(){for(var b=0,a=0;a<this.fireworks.length;a++){if(this.fireworks[a]==null)continue;if(this.fireworks[a].status!=this.FIREWORK_EXPLODED)b++;this.displayFirework(this.fireworks[a])}b==0&&$("#form").fadeIn("slow");$("#fireCount").html(b)},addFireworks:function(){if(this.blockPointer>=this.allBlocks.length)return;var c=this.fireworks[this.fireworks.length]=new Firework(this.fireworks.length),a=this.allBlocks[this.blockPointer][0];a=a/300*this.DISPERSION_HEIGHT;var b=this.allBlocks[this.blockPointer][1];b=(10-b)/100*this.DISPERSION_WIDTH+3.5;this.launchFirework(c,a,b);this.blockPointer++;setTimeout("FireworkDisplay.addFireworks()",1e3/this.DEPLOYMENT_RATE)},getTinyUrl:function(){var a="http://js-fireworks.appspot.com?msg="+escape($("#firetext").val());API="http://json-tinyurl.appspot.com/?url=";document.getElementsByTagName("body")[0].appendChild(function(){var b=document.createElement("script");b.type="text/javascript";b.src=API+encodeURIComponent(a)+"&callback=FireworkDisplay.updateTinyUrl";return b}())},updateTinyUrl:function(a){$("#url").val(a.tinyurl)},launchText:function(){this.getTinyUrl();this.fireworks=[];this.blockPointer=0;clearTimeout(this.gameloop);$("#svg-div").svg({onLoad:function(a){FireworkDisplay.svg=a}});this.canvaswidth=$(window).width();this.canvasheight=$(window).height();var b=$("#firetext").val();pageTracker&&pageTracker._trackPageview("/launched/"+escape(b));var i=0,e=[],f=0;e[f]=0;for(var a=0;a<b.length;a++)if(b.charAt(a)==" "){i+=this.TEXT_LINE_HEIGHT;f++;e[f]=0}else{for(var c=0,d=0;d<FONT_FIREWORK[b.charAt(a)].length;d++){var h=FONT_FIREWORK[b.charAt(a)][d];c=Math.max(c,h[0])}e[f]+=c+40}this.allBlocks=[];var l=$(window).height(),g=i;g+=(l-i)/6;for(var j=0,k=0,a=0;a<b.length;a++)if(b.charAt(a)==" "){k++;g=g-this.TEXT_LINE_HEIGHT;j=0}else{for(var c=0,d=0;d<FONT_FIREWORK[b.charAt(a)].length;d++){var h=FONT_FIREWORK[b.charAt(a)][d];this.allBlocks[this.allBlocks.length]=[h[0]+j-e[k]/2,h[1]-g];c=Math.max(c,h[0])}j+=c+40}this.gameloop=setInterval("FireworkDisplay.updateDisplay()",1e3/this.FRAME_RATE);this.addFireworks();$("#form").fadeOut("slow")},launchFirework:function(a,b,c){a.dx=b;a.dy=c;a.status=this.FIREWORK_LAUNCHED},disperseFirework:function(b,a){b.dx=a*(.5-Math.random());b.dy=a*(.5-Math.random())+1},explodeFirework:function(a){a.status=this.FIREWORK_EXPLODED;a.r=Math.random()/2+.5;a.g=Math.random()/2+.5;a.b=Math.random()/2+.5;a.brightness=200;for(var d=Math.random()*this.FIREWORK_PAYLOAD,c=0;c<d;c++){var b=this.fireworks[this.fireworks.length]=new Firework(this.fireworks.length);b.x=a.x;b.y=a.y;b.r=a.r;b.g=a.g;b.b=a.b;b.status=this.FIREWORK_FRAGMENT;this.disperseFirework(b,Math.random()*this.FRAGMENT_SPREAD)}},destroyFirework:function(a){a.line&&this.svg.remove(a.line);a.line=null;this.fireworks[a.index]=null},displayFirework:function(a){a.y<0&&this.destroyFirework(a);if(a.status==this.FIREWORK_EXPLODED){if(a.line){var c=3,d=true;this.svg.circle(a.x,this.canvasheight-a.y,c,{fill:"yellow",stroke:"yellow",strokeWidth:1});this.svg.remove(a.line);a.line=null}this.destroyFirework(a);return}a.colour="rgb(80, 80, 80)";var b={x:0,y:-.05};if(a.status==this.FIREWORK_FRAGMENT){b.y=this.GRAVITY/-100;a.colour="rgb("+Math.round(a.r*a.brightness)+", "+Math.round(a.g*a.brightness)+", "+Math.round(a.b*a.brightness)+")";a.brightness-=5}a.dy<-1&&a.status==this.FIREWORK_LAUNCHED&&this.explodeFirework(a);a.start={x:a.x,y:a.y};a.dx+=b.x*this.FIREWORK_SPEED;a.dy+=b.y*this.FIREWORK_SPEED;a.x+=a.dx*this.FIREWORK_SPEED;a.y+=a.dy*this.FIREWORK_SPEED;if(a.previous){if(a.line){a.line.setAttribute("x1",a.previous.x);a.line.setAttribute("x2",a.x);a.line.setAttribute("y1",this.canvasheight-a.previous.y);a.line.setAttribute("y2",this.canvasheight-a.y)}}else a.line=this.svg.line(null,0,0,0,0,{stroke:a.colour,strokeWidth:2});a.previous={x:a.start.x,y:a.start.y}}};Firework=function(a){this.index=a;this.dx=0;this.dy=0;this.x=FireworkDisplay.canvaswidth/2;this.y=0;this.status=FireworkDisplay.FIREWORK_READY;this.brightness=255;this.r=1;this.g=1;this.b=1;this.start={x:0,y:0};this.previous=0};$(document).ready(function(){$("#firetext").blur(function(){FireworkDisplay.getTinyUrl()})});var resizeTimer=null;$(window).bind("resize",function(){if(document.all)return;resizeTimer&&clearTimeout(resizeTimer);resizeTimer=setTimeout("location.reload()",100)});var FONT_FIREWORK={"!":[[5,-40],[5,-30],[5,-20],[5,0]],'"':[[20,-40],[20,-30],[5,-40],[5,-30]],"#":[[35,-40],[45,-30],[35,-30],[15,-40],[25,-30],[35,-20],[45,-10],[15,-30],[35,-10],[5,-30],[15,-20],[25,-10],[35,0],[15,-10],[5,-10],[15,0]],"%":[[45,-40],[35,-30],[15,-40],[45,-10],[5,-40],[15,-30],[25,-20],[35,-10],[45,0],[5,-30],[35,0],[15,-10],[5,0]],"&":[[35,-40],[25,-40],[35,-30],[15,-40],[35,-20],[15,-30],[25,-20],[15,-20],[25,-10],[35,0],[5,-20],[25,0],[5,-10],[15,0],[25,10],[5,0]],"'":[[5,-40],[5,-30]],"(":[[15,-40],[5,-30],[5,-20],[5,-10],[15,0]],")":[[5,-40],[15,-30],[15,-20],[15,-10],[5,0]],"*":[[25,-40],[5,-40],[15,-30],[25,-20],[5,-20]],"+":[[20,-40],[35,-20],[20,-30],[25,-20],[15,-20],[20,-10],[5,-20],[20,0]],",":[[5,0],[5,10]],"-":[[35,-20],[25,-20],[15,-20],[5,-20]],"-":[[35,-20],[25,-20],[15,-20],[5,-20]],".":[[5,0]],"/":[[45,-40],[35,-30],[25,-20],[15,-10],[5,0]],":":[[5,-30],[5,-10]],";":[[5,-30],[5,-10],[5,0]],"<":[[15,-25],[5,-15],[15,-5]],"=":[[35,-30],[25,-30],[15,-30],[35,-10],[5,-30],[25,-10],[15,-10],[5,-10]],">":[[5,-25],[15,-15],[5,-5]],"?":[[35,-40],[25,-40],[35,-30],[15,-40],[35,-20],[5,-40],[25,-20],[15,-20],[15,0]],"@":[[35,-30],[25,-40],[15,-40],[35,-20],[25,-20],[35,-10],[5,-30],[35,0],[15,-15],[5,-20],[25,0],[15,-5],[5,-10],[15,5],[5,0]],A:[[35,-30],[25,-40],[15,-40],[35,-20],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20],[5,-10],[5,0]],B:[[25,-40],[15,-40],[25,-30],[35,-20],[5,-40],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20],[25,0],[5,-10],[15,0],[5,0]],C:[[35,-40],[25,-40],[15,-40],[5,-30],[35,0],[5,-20],[25,0],[5,-10],[15,0]],D:[[35,-30],[25,-40],[15,-40],[35,-20],[5,-40],[35,-10],[5,-30],[5,-20],[25,0],[5,-10],[15,0],[5,0]],E:[[35,-40],[25,-40],[15,-40],[5,-40],[25,-20],[5,-30],[15,-20],[35,0],[5,-20],[25,0],[5,-10],[15,0],[5,0]],F:[[35,-40],[25,-40],[15,-40],[5,-40],[25,-20],[5,-30],[15,-20],[5,-20],[5,-10],[5,0]],G:[[35,-40],[25,-40],[15,-40],[35,-20],[25,-20],[35,-10],[5,-30],[35,0],[5,-20],[25,0],[5,-10],[15,0]],H:[[35,-40],[35,-30],[35,-20],[5,-40],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20],[5,-10],[5,0]],I:[[25,-40],[15,-40],[5,-40],[15,-30],[15,-20],[15,-10],[25,0],[15,0],[5,0]],J:[[35,-40],[25,-40],[35,-30],[35,-20],[35,-10],[25,0],[5,-10],[15,0]],K:[[35,-40],[25,-30],[5,-40],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20],[5,-10],[5,0]],L:[[5,-40],[5,-30],[35,0],[5,-20],[25,0],[5,-10],[15,0],[5,0]],M:[[35,-40],[35,-30],[25,-30],[35,-20],[5,-40],[15,-30],[35,-10],[20,-20],[5,-30],[35,0],[5,-20],[5,-10],[5,0]],N:[[35,-40],[35,-30],[35,-20],[5,-40],[15,-30],[25,-20],[35,-10],[5,-30],[35,0],[5,-20],[5,-10],[5,0]],O:[[35,-30],[25,-40],[15,-40],[35,-20],[35,-10],[5,-30],[5,-20],[25,0],[5,-10],[15,0]],P:[[35,-30],[25,-40],[15,-40],[5,-40],[25,-20],[5,-30],[15,-20],[5,-20],[5,-10],[5,0]],Q:[[35,-30],[25,-40],[15,-40],[35,-20],[35,-10],[5,-30],[25,-10],[35,0],[5,-20],[25,0],[5,-10],[15,0]],R:[[35,-30],[25,-40],[15,-40],[5,-40],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20],[5,-10],[5,0]],S:[[35,-35],[25,-40],[15,-40],[35,-15],[25,-20],[5,-35],[35,-5],[15,-20],[5,-25],[25,0],[15,0],[5,-5]],T:[[35,-40],[25,-40],[15,-40],[20,-30],[5,-40],[20,-20],[20,-10],[20,0]],U:[[35,-40],[35,-30],[35,-20],[5,-40],[35,-10],[5,-30],[5,-20],[25,0],[5,-10],[15,0]],V:[[35,-40],[35,-30],[35,-20],[5,-40],[5,-30],[25,-10],[5,-20],[15,-10],[20,0]],W:[[35,-40],[35,-30],[20,-40],[35,-20],[20,-30],[5,-40],[35,-10],[20,-20],[5,-30],[35,0],[20,-10],[5,-20],[25,0],[5,-10],[15,0]],X:[[35,-40],[25,-30],[5,-40],[15,-30],[20,-20],[25,-10],[35,0],[15,-10],[5,0]],Y:[[35,-40],[35,-30],[5,-40],[25,-20],[5,-30],[15,-20],[20,-10],[20,0]],Z:[[35,-40],[25,-40],[15,-40],[25,-30],[5,-40],[20,-20],[35,0],[15,-10],[25,0],[15,0],[5,0]],_:[[45,0],[35,0],[25,0],[15,0],[5,0]],a:[[25,-30],[35,-20],[15,-30],[35,-10],[25,-15],[5,-30],[35,0],[15,-15],[25,0],[5,-10],[15,0]],b:[[25,-30],[35,-20],[5,-40],[15,-30],[35,-10],[5,-30],[5,-20],[25,0],[5,-10],[15,0],[5,0]],c:[[35,-30],[25,-30],[15,-30],[35,0],[5,-20],[25,0],[5,-10],[15,0]],d:[[35,-40],[35,-30],[25,-30],[35,-20],[15,-30],[35,-10],[35,0],[5,-20],[25,0],[5,-10],[15,0]],e:[[25,-30],[35,-20],[15,-30],[25,-15],[35,0],[15,-15],[5,-20],[25,0],[5,-10],[15,0]],f:[[25,-40],[15,-40],[25,-20],[5,-30],[15,-20],[5,-20],[5,-10],[5,0]],g:[[35,-30],[25,-30],[35,-20],[15,-30],[35,-10],[25,-10],[35,0],[5,-20],[15,-10],[25,10],[15,10],[5,10]],h:[[5,-40],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20],[5,-10],[5,0]],i:[[5,-40],[5,-20],[5,-10],[5,0]],j:[[15,-40],[15,-20],[15,-10],[15,0],[5,10]],k:[[35,-30],[5,-40],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20],[5,-10],[5,0]],l:[[5,-40],[5,-30],[5,-20],[5,-10],[15,0]],m:[[35,-30],[45,-20],[25,-30],[45,-10],[15,-30],[25,-20],[45,0],[5,-30],[25,-10],[5,-20],[25,0],[5,-10],[5,0]],n:[[25,-30],[35,-20],[15,-30],[35,-10],[5,-30],[35,0],[5,-20],[5,-10],[5,0]],o:[[25,-30],[35,-20],[15,-30],[35,-10],[5,-20],[25,0],[5,-10],[15,0]],p:[[25,-30],[35,-20],[15,-30],[35,-10],[5,-30],[5,-20],[25,0],[5,-10],[15,0],[5,0],[5,10]],q:[[35,-30],[25,-30],[35,-20],[15,-30],[35,-10],[35,0],[5,-20],[25,0],[35,10],[5,-10],[15,0]],r:[[35,-30],[25,-30],[5,-30],[15,-20],[5,-20],[5,-10],[5,0]],s:[[35,-30],[25,-30],[15,-30],[35,-10],[25,-15],[15,-15],[5,-20],[25,0],[15,0],[5,0]],t:[[25,-30],[5,-40],[15,-30],[5,-30],[5,-20],[25,0],[5,-10],[15,0]],u:[[35,-30],[35,-20],[35,-10],[5,-30],[35,0],[5,-20],[25,0],[5,-10],[15,0]],v:[[35,-30],[35,-20],[5,-30],[25,-10],[5,-20],[15,-10],[20,0]],w:[[35,-30],[35,-20],[20,-30],[35,-10],[20,-20],[5,-30],[35,0],[20,-10],[5,-20],[25,0],[5,-10],[15,0]],x:[[35,-30],[25,-20],[5,-30],[15,-20],[25,-10],[35,0],[15,-10],[5,0]],y:[[35,-30],[35,-20],[35,-10],[5,-30],[25,-10],[35,0],[5,-20],[15,-10],[25,10],[15,10]],z:[[35,-30],[25,-30],[15,-30],[25,-20],[5,-30],[35,0],[15,-10],[25,0],[15,0],[5,0]],"0":[[35,-30],[25,-40],[15,-40],[35,-20],[35,-10],[15,-25],[25,-15],[5,-30],[5,-20],[25,0],[5,-10],[15,0]],"1":[[15,-40],[15,-30],[5,-30],[15,-20],[15,-10],[15,0]],"2":[[35,-35],[25,-40],[35,-25],[15,-40],[25,-20],[5,-35],[15,-20],[35,0],[25,0],[5,-10],[15,0],[5,0]],"3":[[25,-40],[35,-30],[15,-40],[5,-40],[25,-20],[35,-10],[15,-20],[25,0],[15,0],[5,0]],"4":[[35,-40],[35,-30],[35,-20],[5,-40],[25,-20],[35,-10],[5,-30],[15,-20],[35,0],[5,-20]],"5":[[35,-40],[25,-40],[15,-40],[35,-15],[5,-40],[25,-20],[35,-5],[5,-30],[15,-20],[5,-20],[25,0],[15,0],[5,0]],"6":[[35,-40],[25,-40],[15,-40],[35,-20],[25,-20],[35,-10],[5,-30],[15,-20],[5,-20],[25,0],[5,-10],[15,0]],"7":[[35,-40],[35,-30],[25,-40],[15,-40],[5,-40],[25,-20],[5,-30],[25,-10],[25,0]],"8":[[35,-35],[25,-40],[35,-25],[15,-40],[35,-15],[25,-20],[5,-35],[35,-5],[15,-20],[5,-25],[25,0],[5,-15],[15,0],[5,-5]],"9":[[35,-30],[25,-40],[15,-40],[35,-20],[25,-20],[35,-10],[5,-30],[15,-20],[5,-20],[25,0],[15,0],[5,0]]}